# FavaleTrainer CRM - Sistema de CRM para Personal Trainers

## üìã Vis√£o Geral

O **FavaleTrainer CRM** √© um sistema completo de gerenciamento de relacionamento com clientes (CRM) desenvolvido especificamente para personal trainers da empresa Favale. O sistema integra funcionalidades modernas de gest√£o de leads, tarefas, comunica√ß√£o via WhatsApp e an√°lise de dados, proporcionando uma solu√ß√£o completa para profissionais de fitness.

## üèóÔ∏è Arquitetura e Stack Tecnol√≥gica

### **Frontend**
- **Next.js 15.3.4** - Framework React com App Router
- **TypeScript** - Tipagem est√°tica
- **Tailwind CSS** - Framework CSS utilit√°rio
- **shadcn/ui** - Biblioteca de componentes UI moderna
- **Radix UI** - Componentes primitivos acess√≠veis
- **Framer Motion** - Anima√ß√µes e transi√ß√µes
- **Lucide React** - √çcones SVG
- **React Hook Form** - Gerenciamento de formul√°rios
- **Zod** - Valida√ß√£o de schemas

### **Backend & Database**
- **Supabase** - Backend-as-a-Service (PostgreSQL + Auth + Realtime)
- **Edge Functions** - Processamento serverless
- **Row Level Security (RLS)** - Seguran√ßa a n√≠vel de linha
- **Realtime Subscriptions** - Atualiza√ß√µes em tempo real

### **Integra√ß√µes Externas**
- **Evolution API** - Integra√ß√£o WhatsApp Business
- **Vercel KV** - Cache Redis
- **Papa Parse** - Processamento CSV

### **Gerenciamento de Estado**
- **React Query (TanStack Query)** - Cache e sincroniza√ß√£o de dados
- **React Context** - Estado global de autentica√ß√£o
- **React Hooks** - Estados locais e efeitos

## üîß Estrutura do Projeto

```
NextCRM/
‚îú‚îÄ‚îÄ app/                          # App Router (Next.js 13+)
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leads/                # Gest√£o de leads
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp/             # Integra√ß√£o WhatsApp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-evolution/       # Testes da Evolution API
‚îÇ   ‚îú‚îÄ‚îÄ auth/                     # P√°ginas de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/                # Dashboard principal
‚îÇ   ‚îú‚îÄ‚îÄ leads/                    # Gest√£o de leads
‚îÇ   ‚îú‚îÄ‚îÄ students/                 # Gest√£o de alunos
‚îÇ   ‚îú‚îÄ‚îÄ tasks/                    # Gest√£o de tarefas
‚îÇ   ‚îú‚îÄ‚îÄ whatsapp/                 # Interface WhatsApp
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Layout raiz
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                  # P√°gina inicial
‚îú‚îÄ‚îÄ components/                   # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard/                # Componentes do dashboard
‚îÇ   ‚îú‚îÄ‚îÄ Layout/                   # Layouts da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Leads/                    # Componentes de leads
‚îÇ   ‚îú‚îÄ‚îÄ Tasks/                    # Componentes de tarefas
‚îÇ   ‚îú‚îÄ‚îÄ Whatsapp/                 # Componentes WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ ui/                       # Biblioteca shadcn/ui
‚îú‚îÄ‚îÄ contexts/                     # React Contexts
‚îú‚îÄ‚îÄ hooks/                        # Custom Hooks
‚îú‚îÄ‚îÄ lib/                          # Utilit√°rios e servi√ßos
‚îú‚îÄ‚îÄ types/                        # Defini√ß√µes TypeScript
‚îú‚îÄ‚îÄ utils/                        # Fun√ß√µes utilit√°rias
‚îî‚îÄ‚îÄ supabase/                     # Migra√ß√µes e configura√ß√µes
    ‚îî‚îÄ‚îÄ migrations/               # Migrations SQL
```

## üöÄ Funcionalidades Principais

### **1. Gest√£o de Leads**

#### **Importa√ß√£o de Leads**
- **Importa√ß√£o em lote via CSV** com template pr√©-definido
- **Processamento ass√≠ncrono** em chunks para grandes volumes
- **Valida√ß√£o autom√°tica** de dados (email, telefone, status)
- **Sistema de tags** para categoriza√ß√£o
- **Suporte a m√∫ltiplas empresas** (Favale Functional, Personal, etc.)

#### **Gest√£o Individual**
- **CRUD completo** com interface intuitiva
- **Status personaliz√°veis**: New, Contacted, Converted, Lost
- **Campos flex√≠veis**: nome, email, telefone, empresa, fonte, tags
- **Relacionamento com alunos** - convers√£o autom√°tica
- **Hist√≥rico de intera√ß√µes** e anota√ß√µes

#### **Funcionalidades Avan√ßadas**
- **Opera√ß√µes em lote**: edi√ß√£o e exclus√£o m√∫ltipla
- **Filtros avan√ßados**: por status, empresa, data, tags
- **Busca inteligente**: nome, email, telefone
- **Exporta√ß√£o de dados**
- **Interface responsiva** com tabelas otimizadas

### **2. Sistema de Tarefas (Kanban)**

#### **Organiza√ß√£o Visual**
- **Board Kanban** com colunas personaliz√°veis
- **Drag & Drop** para movimenta√ß√£o de tarefas
- **Cores por prioridade**: Low (verde), Medium (azul), High (laranja), Urgent (vermelho)
- **Cards informativos** com dados relevantes

#### **Gest√£o de Tarefas**
- **Prioridades configr√°veis**: Low, Medium, High, Urgent
- **Datas de vencimento** com alertas visuais
- **Associa√ß√£o com leads** para contexto
- **Estados**: To Do, In Progress, Review, Done
- **Descri√ß√µes detalhadas** e anota√ß√µes

#### **Produtividade**
- **Filtros por status** e prioridade
- **Notifica√ß√µes de prazo** e tarefas pendentes
- **M√©tricas de produtividade** no dashboard
- **Sincroniza√ß√£o em tempo real** entre usu√°rios

### **3. Integra√ß√£o WhatsApp Business**

#### **Configura√ß√£o da Evolution API**
- **Inst√¢ncia dedicada "Leonardo"** auto-configurada
- **QR Code autom√°tico** para pareamento
- **Status de conex√£o** em tempo real
- **Webhook inteligente** para recebimento de mensagens

#### **Comunica√ß√£o Integrada**
- **Chat nativo** dentro do CRM
- **Envio de mensagens** direto dos leads
- **Suporte a m√≠dias**: imagens, v√≠deos, √°udios, documentos
- **Hist√≥rico completo** de conversas
- **Rate limiting** inteligente (30 msg/min)

#### **Recursos Avan√ßados**
- **Lista de conversas** com √∫ltimo contato
- **Indicadores de mensagens** n√£o lidas
- **Busca em conversas** e contatos
- **Interface familiar** similar ao WhatsApp Web
- **Notifica√ß√µes em tempo real**

### **4. Dashboard Anal√≠tico**

#### **KPIs Principais**
- **Total de Leads** com tend√™ncia mensal
- **Taxa de Convers√£o** leads ‚Üí alunos
- **Alunos Ativos** e crescimento
- **Tarefas Pendentes** e conclu√≠das
- **Sess√µes de Treino** (ativas/conclu√≠das)

#### **Visualiza√ß√µes**
- **Gr√°ficos interativos** (Chart.js/Recharts)
- **M√©tricas por per√≠odo** (di√°rio, semanal, mensal)
- **Distribui√ß√£o por fonte** de leads
- **Status pipeline** visual
- **Heatmap de atividades**

#### **Relat√≥rios**
- **Performance temporal** com comparativos
- **An√°lise de convers√£o** por canal
- **Produtividade pessoal** e da equipe
- **Insights autom√°ticos** baseados em dados

### **5. Gest√£o de Alunos**

#### **Convers√£o Autom√°tica**
- **Leads ‚Üí Alunos** com um clique
- **Relacionamento bidirecional** preservado
- **Hist√≥rico mantido** durante convers√£o
- **Status diferenciado** na interface

#### **Acompanhamento**
- **Lista dedicada** de alunos ativos
- **Progresso individual** e metas
- **Sess√µes de treino** agendadas/realizadas
- **Comunica√ß√£o direta** via WhatsApp

## üóÑÔ∏è Estrutura do Banco de Dados

### **Tabelas Principais**

#### **leads**
```sql
- id (UUID, PK)
- user_id (UUID, FK ‚Üí auth.users)
- name (TEXT, NOT NULL)
- email (TEXT, UNIQUE)
- phone (TEXT)
- company (TEXT) -- Favale Functional, Personal, etc.
- status (TEXT) -- New, Contacted, Converted, Lost
- source (TEXT) -- Instagram, Indica√ß√£o, Site, etc.
- tags (TEXT[])
- created_at, updated_at (TIMESTAMP)
```

#### **students**
```sql
- id (UUID, PK)
- lead_id (UUID, FK ‚Üí leads.id)
- user_id (UUID, FK ‚Üí auth.users)
- enrollment_date (DATE)
- status (TEXT) -- Active, Inactive, Suspended
- created_at, updated_at (TIMESTAMP)
```

#### **tasks**
```sql
- id (UUID, PK)
- user_id (UUID, FK ‚Üí auth.users)
- title (TEXT, NOT NULL)
- description (TEXT)
- status (TEXT) -- To Do, In Progress, Review, Done
- priority (TEXT) -- Low, Medium, High, Urgent
- due_date (DATE)
- related_lead_id (UUID, FK ‚Üí leads.id)
- created_at, updated_at (TIMESTAMP)
```

#### **whatsapp_connections**
```sql
- id (UUID, PK)
- user_id (UUID, FK ‚Üí auth.users)
- instance_name (TEXT)
- status (TEXT) -- connecting, connected, disconnected, error
- qr_code (TEXT)
- whatsapp_user (JSONB)
- last_connected_at (TIMESTAMP)
- created_at, updated_at (TIMESTAMP)
```

#### **whatsapp_messages**
```sql
- id (UUID, PK)
- lead_id (UUID, FK ‚Üí leads.id)
- user_id (UUID, FK ‚Üí auth.users)
- message_content (TEXT)
- media_url (TEXT)
- media_type (TEXT)
- is_from_lead (BOOLEAN)
- message_timestamp (TIMESTAMP)
- evolution_message_id (TEXT)
- created_at (TIMESTAMP)
```

#### **training_sessions**
```sql
- id (UUID, PK)
- student_id (UUID, FK ‚Üí students.id)
- user_id (UUID, FK ‚Üí auth.users)
- scheduled_date (TIMESTAMP)
- actual_date (TIMESTAMP)
- status (TEXT) -- Scheduled, Completed, Cancelled, No-show
- notes (TEXT)
- created_at, updated_at (TIMESTAMP)
```

### **Recursos de Seguran√ßa**

#### **Row Level Security (RLS)**
- **Isolamento por usu√°rio**: cada trainer v√™ apenas seus dados
- **Pol√≠ticas autom√°ticas** para todas as tabelas
- **Seguran√ßa na API** e consultas diretas
- **Auditoria completa** de acessos

#### **Autentica√ß√£o**
- **Supabase Auth** integrado
- **Sessions persistentes** e seguras
- **Logout autom√°tico** por inatividade
- **Recupera√ß√£o de senha** por email

## üîó Integra√ß√µes e APIs

### **Evolution API (WhatsApp)**

#### **Configura√ß√£o**
```env
EVOLUTION_API_URL=https://evolution-api.domain.com
EVOLUTION_API_KEY=your-api-key
WHATSAPP_INSTANCE_NAME=Leonardo
NEXT_PUBLIC_WEBHOOK_URL=https://your-app.com/api/whatsapp/webhook
```

#### **Endpoints Utilizados**
- `GET /instance/connect/{instance}` - Conectar inst√¢ncia
- `POST /message/sendText/{instance}` - Enviar texto
- `POST /message/sendMedia/{instance}` - Enviar m√≠dia
- `GET /instance/fetchInstances` - Status das inst√¢ncias
- `POST /webhook/set/{instance}` - Configurar webhook

#### **Webhook Events**
- `CONNECTION_UPDATE` - Status da conex√£o
- `MESSAGES_UPSERT` - Novas mensagens
- `CHATS_UPSERT` - Novos chats
- `CHATS_UPDATE` - Atualiza√ß√µes de chat

### **Supabase Realtime**

#### **Subscriptions Ativas**
- **whatsapp_messages**: Mensagens em tempo real
- **whatsapp_connections**: Status de conex√£o
- **tasks**: Atualiza√ß√µes de tarefas
- **leads**: Mudan√ßas nos leads

## üé® Interface e UX

### **Design System**

#### **Paleta de Cores**
- **Primary**: Sistema baseado no tema escuro/claro
- **Company Colors**: 
  - Favale Functional: Verde (#22c55e)
  - Personal Training: Azul (#3b82f6)
  - FIT: Roxo (#8b5cf6)

#### **Componentes**
- **Design consistente** com shadcn/ui
- **Acessibilidade** (ARIA, contraste, keyboard navigation)
- **Responsividade** mobile-first
- **Loading states** e skeleton screens
- **Error boundaries** para estabilidade

#### **Temas**
- **Light/Dark mode** autom√°tico
- **Persist√™ncia** da prefer√™ncia
- **Transi√ß√µes suaves** entre temas
- **Compatibilidade** com prefer√™ncias do sistema

### **Navega√ß√£o**

#### **Sidebar Inteligente**
- **√çcones intuitivos** com labels
- **Estados ativos** destacados
- **Contadores din√¢micos** (tarefas pendentes, mensagens)
- **Collapse/expand** para economizar espa√ßo

#### **Breadcrumbs**
- **Navega√ß√£o contextual** em p√°ginas profundas
- **Hist√≥rico preservado** ao voltar
- **Links funcionais** para navega√ß√£o r√°pida

## üìä M√©tricas e Analytics

### **KPIs Monitorados**

#### **Vendas e Convers√£o**
- **Leads por per√≠odo** (di√°rio, semanal, mensal)
- **Taxa de convers√£o** leads ‚Üí alunos
- **Tempo m√©dio** para convers√£o
- **Fontes mais efetivas** de leads
- **Performance por personal trainer**

#### **Operacional**
- **Tarefas completadas** vs pendentes
- **Tempo de resposta** no WhatsApp
- **Sess√µes agendadas** vs realizadas
- **Taxa de no-show** dos alunos

#### **Engajamento**
- **Intera√ß√µes por lead** (calls, whatsapp, emails)
- **Tempo m√©dio** de resposta
- **Satisfa√ß√£o** baseada em convers√µes
- **Reten√ß√£o** de alunos

### **Relat√≥rios Automatizados**

#### **Dashboard Executive**
- **Vis√£o consolidada** de m√©tricas principais
- **Comparativos** per√≠odo anterior
- **Tend√™ncias** e proje√ß√µes
- **Alertas** de performance

#### **Relat√≥rios Personalizados**
- **Filtros avan√ßados** por per√≠odo, trainer, empresa
- **Exporta√ß√£o** PDF/CSV
- **Agendamento** de relat√≥rios recorrentes
- **Compartilhamento** com stakeholders

## üöÄ Deploy e Infraestrutura

### **Vercel (Frontend)**
- **Deploy autom√°tico** via Git push
- **Edge Functions** para performance
- **Domain customizado** com SSL
- **Analytics** e monitoring integrados

### **Supabase (Backend)**
- **Database PostgreSQL** na nuvem
- **Automatic backups** di√°rios
- **SSL/TLS** por padr√£o
- **Monitoring** de performance

### **Evolution API**
- **Self-hosted** em servidor dedicado
- **Docker containerized**
- **Reverse proxy** (Nginx)
- **Monitoring** de uptime

### **Vari√°veis de Ambiente**

#### **Produ√ß√£o**
```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Evolution API
EVOLUTION_API_URL=https://evolution.yourdomain.com
EVOLUTION_API_KEY=your-evolution-key
WHATSAPP_INSTANCE_NAME=Leonardo
NEXT_PUBLIC_WEBHOOK_URL=https://yourapp.vercel.app/api/whatsapp/webhook

# Redis (Opcional)
KV_URL=your-vercel-kv-url
KV_REST_API_URL=your-kv-rest-url
KV_REST_API_TOKEN=your-kv-token
```

## üîß Desenvolvimento Local

### **Pr√©-requisitos**
- Node.js 18+ 
- npm/yarn/pnpm
- Git
- Conta Supabase
- Evolution API configurada

### **Configura√ß√£o**

#### **1. Clone e Instale**
```bash
git clone <repository-url>
cd NextCRM
npm install
```

#### **2. Configure Ambiente**
```bash
cp .env.example .env.local
# Configure todas as vari√°veis necess√°rias
```

#### **3. Configure Supabase**
```bash
# Execute as migrations
npx supabase db push

# Configure RLS policies
# Dados de exemplo (opcional)
npm run seed
```

#### **4. Inicie o Desenvolvimento**
```bash
npm run dev
# Aplica√ß√£o dispon√≠vel em http://localhost:3000
```

### **Scripts Dispon√≠veis**
```json
{
  "dev": "next dev",                    // Desenvolvimento
  "build": "next build",                // Build de produ√ß√£o
  "start": "next start",                // Servidor de produ√ß√£o
  "lint": "next lint",                  // Linting do c√≥digo
  "type-check": "tsc --noEmit"          // Verifica√ß√£o de tipos
}
```

## üß™ Testes e Qualidade

### **Estrat√©gia de Testes**
- **TypeScript** para verifica√ß√£o de tipos
- **ESLint** para qualidade de c√≥digo
- **Prettier** para formata√ß√£o consistente
- **Testes de integra√ß√£o** com APIs

### **Monitoramento**

#### **Performance**
- **Vercel Analytics** para m√©tricas web
- **Core Web Vitals** monitorados
- **Error tracking** autom√°tico
- **Query performance** via React Query DevTools

#### **Logs**
- **Structured logging** com prefixos
- **Error boundaries** para captura de erros
- **API monitoring** com status codes
- **WhatsApp integration** logging detalhado

## üìà Roadmap e Melhorias Futuras

### **Curto Prazo (1-3 meses)**
- [ ] **Notifica√ß√µes push** para tarefas e mensagens
- [ ] **Calend√°rio integrado** para agendamentos
- [ ] **Templates** de mensagens WhatsApp
- [ ] **Relat√≥rios PDF** autom√°ticos
- [ ] **Backup/restore** de dados

### **M√©dio Prazo (3-6 meses)**
- [ ] **App m√≥vel** (React Native/PWA)
- [ ] **Integra√ß√£o calend√°rio** (Google Calendar)
- [ ] **Automa√ß√µes** de marketing
- [ ] **AI para an√°lise** de sentimento
- [ ] **Multi-tenant** para m√∫ltiplas empresas

### **Longo Prazo (6+ meses)**
- [ ] **Pagamentos integrados** (Stripe/PagSeguro)
- [ ] **CRM avan√ßado** com funil de vendas
- [ ] **Marketplace** de personal trainers
- [ ] **Analytics preditivos** com ML
- [ ] **Integra√ß√µes** com equipamentos fitness

## ü§ù Contribui√ß√£o e Suporte

### **Estrutura de Desenvolvimento**
- **Feature branches** para novas funcionalidades
- **Code review** obrigat√≥rio
- **Conventional commits** para versionamento
- **Semantic versioning** para releases

### **Documenta√ß√£o**
- **README.md** para setup b√°sico
- **WHATSAPP_INTEGRATION.md** para configura√ß√£o WhatsApp
- **CLAUDE.MD** (este arquivo) para vis√£o geral
- **JSDoc** inline para fun√ß√µes complexas

### **Contato e Suporte**
- **Issues** no reposit√≥rio para bugs
- **Discussions** para perguntas gerais
- **Wiki** com documenta√ß√£o adicional
- **Slack/Discord** para comunica√ß√£o r√°pida

---

## üìù Conclus√£o

O **FavaleTrainer CRM** representa uma solu√ß√£o moderna e completa para personal trainers, combinando as melhores pr√°ticas de desenvolvimento web com funcionalidades espec√≠ficas do setor fitness. A arquitetura escal√°vel, integra√ß√£o WhatsApp nativa e interface intuitiva fazem dele uma ferramenta poderosa para crescimento do neg√≥cio.

A escolha tecnol√≥gica (Next.js + Supabase + Evolution API) garante performance, seguran√ßa e facilidade de manuten√ß√£o, enquanto o design system baseado em shadcn/ui proporciona uma experi√™ncia de usu√°rio consistente e profissional.

**Vers√£o do Documento**: 1.0  
**√öltima Atualiza√ß√£o**: Julho 2025  
**Autor**: Equipe de Desenvolvimento Favale
